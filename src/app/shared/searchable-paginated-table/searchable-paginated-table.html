<section class="searchable-paginated-table">
  <!-- Search Bar -->
  <div class="d-flex justify-content-between align-items-center mb-4" *ngIf="showSearch || showSort">
    <div class="d-flex align-items-center gap-3" *ngIf="showSearch">
      <div class="search-box">
        <i class="bi bi-search text-muted"></i>
        <input
          type="text"
          [placeholder]="searchPlaceholder"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange($event)"
        />
      </div>
    </div>

    <div class="d-flex align-items-center gap-3" *ngIf="showSort">
      <div class="dropdown" [class.show]="dropdownOpen">
        <button
          class="btn btn-light border dropdown-toggle"
          type="button"
          (click)="toggleDropdown()"
         
          aria-expanded="false"
        >
          Sort by: {{ sortByNewest ? 'Newest' : 'Oldest' }}
        </button>
        <ul class="dropdown-menu dropdown-menu-end" [class.show]="dropdownOpen">
          <li [class.active]="sortByNewest">
            <button class="dropdown-item" (click)="setSortNewest()">
              Newest
            </button>
          </li>
          <li [class.active]="!sortByNewest">
            <button class="dropdown-item" (click)="setSortOldest()">
              Oldest
            </button>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead>
            <tr>
              <th *ngFor="let col of columns" [class.sortable]="col.sortable !== false">
                <div class="d-flex align-items-center gap-2">
                  <span>{{ col.label }}</span>
                  <i
                    *ngIf="col.sortable !== false"
                    class="bi"
                    [ngClass]="getSortIcon(col.key)"
                    (click)="onSortChange(col.key)"
                    style="cursor: pointer;"
                  ></i>
                </div>
              </th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Custom row template -->
            <ng-container *ngIf="rowTemplate">
              <tr
                *ngFor="let item of visibleData; let i = index; trackBy: trackByIndex"
                [class.table-row--highlighted]="hoveredRow === i"
                (mouseenter)="hoveredRow = i"
                (mouseleave)="hoveredRow = null"
              >
                <ng-container *ngTemplateOutlet="rowTemplate; context: { $implicit: item, index: i }"></ng-container>
              </tr>
            </ng-container>

            <!-- Default row template -->
            <ng-container *ngIf="!rowTemplate">
              <tr
                *ngFor="let item of visibleData; let i = index; trackBy: trackByIndex"
                class="table-row"
                [class.table-row--highlighted]="hoveredRow === i"
                (mouseenter)="hoveredRow = i"
                (mouseleave)="hoveredRow = null"
              >
                <td *ngFor="let col of columns">
                  {{ item[col.key] }}
                </td>
                <td class="text-end">
                  <button class="btn btn-light btn-sm rounded-circle me-1" (click)="editItem(item)">
                    <i class="bi bi-pencil text-primary"></i>
                  </button>
                  <button class="btn btn-light btn-sm rounded-circle" (click)="deleteItem(item)">
                    <i class="bi bi-trash text-danger"></i>
                  </button>
                </td>
              </tr>
            </ng-container>

            <!-- Empty state -->
            <tr *ngIf="visibleData.length === 0">
              <td [attr.colspan]="columns.length + 1" class="text-center text-muted py-4">
                No {{ recordLabel.toLowerCase() }} found.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-between align-items-center mt-3 small text-muted" *ngIf="showPagination">
    <div>
      <ng-container *ngIf="totalRecords > 0; else emptyState">
        {{ rangeStart }}-{{ rangeEnd }} of {{ totalRecords }} {{ recordLabel }}
      </ng-container>
      <ng-template #emptyState>0 {{ recordLabel }}</ng-template>
    </div>

    <nav aria-label="Table pagination">
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="goToPage(currentPage - 1)" aria-label="Previous">
            ‹
          </button>
        </li>

        <li
          *ngFor="let page of pages"
          class="page-item"
          [class.active]="page === currentPage"
        >
          <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
        </li>

        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="goToPage(currentPage + 1)" aria-label="Next">
            ›
          </button>
        </li>
      </ul>
    </nav>
  </div>
</section>
